<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>jiejie 杰杰设计 </title>
    <link rel="stylesheet" href="/global/reset.css">
    <link rel="stylesheet" href="/global/global.css">
    <link rel="stylesheet" href="/home/home.css">
</head>
<body>

<div id="header">
    <img class="logo" src="/global/images/logo.png" alt="杰杰设计">
    <!--<ul>
        <li id="about-nav">关于我们</li>
        <li id="wedo-nav">我们能做</li>
        <li id="portfolio-nav" class="checked">设计作品</li>
        <li id="design-nav">设计师</li>
        <li id="contact-nav">联系我们</li>
    </ul>-->
    <img src="/global/images/nav.png" usemap="#Map" class="nav">
    <map name="Map"><area shape="rect" class="notify-contact" coords="480,3,583,33" href="#copy-right"><area shape="rect" coords="360,2,463,32" href="#show"><area shape="rect" coords="242,2,345,32" href="#portfolio"><area shape="rect" coords="118,2,221,32" href="#what-we-do">
        <area shape="rect" coords="3,3,106,33" href="#about">
    </map>
</div>

<div id="banner">
    <div id="banner-container">
        <div id="banner-switch" class="s-demo scrollable">
            <div class="prev-and-next">
                <span id="scroller-prev-banner" class="prev disable">&lsaquo; 上一页</span>
                <span id="scroller-next-banner" class="next">下一页 &rsaquo;</span>
            </div>

            <div class="scroller">
                <div class="ks-switchable-content">
                    <div class="banner contact"
                         style="background-image: url(http://www.jeef.com.cn:1280/file/50f258368d1858a03b002867)"><p><a
                            href="#copy-right" class="notify-contact">联系我们</a></p></div>
                    <div class="banner"
                         style="background-image: url(http://localhost/file/50eff1cdd6aee4d02500b10e_670)"></div>
                </div>
            </div>
        </div>
    </div>
</div>


<div id="nav-container">
    <div id="nav">
        <div id="nav-content">
            <div id="point">
                <a class="home" href="#"></a>
                <a class="active" href="#about"></a>
                <a href="#what-we-do"></a>
                <a href="#portfolio"></a>
                <a href="#show"></a>
                <a class="notify-contact" href="#copy-right"></a>
            </div>
        </div>
    </div>
</div>

<div id="about" class="item">
    <div id="team">
        <div id="team-container">

        </div>
    </div>
</div>

<div id="what-we-do" class="item">

</div>


<div id="portfolio" class="item">
    <img src="/global/images/portfolio.png">

    <div class="nav-bar" id="nav-field">
        <b id="category-field" class="category" data-field="category">按类型</b>
        <b id="color-field" class="color" data-field="color">按色系</b>
        <b id="series-field" class="series" data-field="series">按系列</b>
    </div>
    <div id="filter-waterfall" class="clearfix">
        <div class="active">
            <b data-value="活动页" style="width: 165px;">活动页</b>
            <b data-value="Banner" style="width: 165px;">Banner</b>
            <b data-value="WEB" style="width: 165px;">WEB</b>
            <b data-value="EDM" style="width: 165px;">EDM</b>
            <b data-value="手机端" style="width: 165px;">手机端</b>
            <b data-value="其他" style="width: 165px;">其他</b>
        </div>
        <div class="color">
            <b data-value="蓝色" style="width: 82px;border-bottom-color:#0065FE;">蓝色</b>
            <b data-value="橙色" style="width: 82px;border-bottom-color:#FE6C00;">橙色</b>
            <b data-value="红色" style="width: 82px;border-bottom-color: red">红色</b>
            <b data-value="粉色" style="width: 82px;border-bottom-color: #D744BA;">粉色</b>
            <b data-value="绿色" style="width: 82px;border-bottom-color:#59A725;">绿色</b>
            <b data-value="青色" style="width: 82px;border-bottom-color:#06B7C8;">青色</b>
            <b data-value="黄色" style="width: 82px;border-bottom-color:#FEBF00;">黄色</b>
            <b data-value="棕色" style="width: 82px;border-bottom-color:#733413;">棕色</b>
            <b data-value="黑色" style="width: 82px;border-bottom-color:black;">黑色</b>
            <b data-value="紫色" style="width: 82px;border-bottom-color:#892BCF;">紫色</b>
            <b data-value="白色" style="width: 88px;border-bottom-color:white;">白色</b>
            <b data-value="配色" style="width: 82px;border-bottom-color: #df6053;">配色</b>
        </div>
        <div>
            <b data-value="清爽系" style="width: 198px;">清爽系</b>
            <b data-value="深色系" style="width: 198px;">深色系</b>
            <b data-value="双11" style="width: 198px;">双11</b>
            <b data-value="中国风" style="width: 198px;">中国风</b>
            <b data-value="绝密档案活动页" style="width: 198px;">绝密档案活动页</b>
        </div>
    </div>
    <div id="portfolio-container">

    </div>
    <div id="p" class="clearfix"><b class="prev">上一页</b> <b class="next">下一页</b></div>
</div>

<div id="show" class="item">
    <img src="/global/images/mien.png">

    <div id="demo6" class="s-demo scrollable">
        <span id="scroller-prev" class="prev disable">&lsaquo; 上一页</span>
        <span id="scroller-next" class="next">下一页 &rsaquo;</span>

        <div class="scroller">
            <div class="ks-switchable-content" id="ks-switchable-content">

            </div>

        </div>
    </div>
</div>


<script src="http://a.tbcdn.cn/s/kissy/1.3.0/seed-min.js"></script>
<script type="text/javascript">
    KISSY.use("event,dom,switchable,datalazyload,ajax", function (S, Event, DOM, Switchable) {
        var Carousel = Switchable.Carousel;

        KISSY.io({
            url: '/filter',
            type: 'get',
            dataType: 'json',
            data: {
                category: '1风采秀'
            },
            success: function (data) {
                var container = DOM.get('#ks-switchable-content');
                var li = '';
                S.each(data.docs, function (item) {
                    li += '<div class="pic" data-id="' + item._id + '" style="background-image:url(/file/' + item._id + ')"></div>'
                });
                DOM.html(container, li);
                //通过DOM元素新建旋转木马
                var carousel = new Carousel('#demo6', {
                    effect: 'scrollx',
                    easing: 'easeOutStrong',
                    steps: 7,
                    viewSize: [987],
                    circular: false,
                    hasTriggers: false,
                    prevBtnCls: 'prev',
                    nextBtnCls: 'next',
                    //autoplay:true,//是否自动切换
                    disableBtnCls: 'disable',
                    lazyDataType: 'img-src'
                });

            }
        });

        var banner = new Switchable.Slide('#banner-switch', {
            effect: 'fade',
            easing: 'easeOutStrong',
            autoplay: true,
            delay: 1
        });

        Event.on('#scroller-prev-banner', 'mousedown', function () {
            banner.prev();
        });

        Event.on('#scroller-next-banner', 'mousedown', function () {
            banner.next();
        });


    });
</script>

<script type="tpl" id="tpl">
    {{#each docs as item index}}
    <b class="pic-container" data-id="{{item._id}}"><span class="pic"
                                   style="background-image:url(/file/{{item._id}}_170)"></span></b>
    {{/each}}
</script>

<div id="copy-right">
    <div class="item">
        <p class="copyright">Copyright &copy; 2012 jiejie. All rights reserved.</p>

        <p class="contact">
            <span class="phone"><s></s>0571-88838528-886</span>
            <a class="email" href="mailto:maomao@suncn.cn"><s></s>maomao@suncn.cn</a>
        </p>
    </div>
</div>

<script type="text/javascript">
KISSY.use("gallery/template/1.0/,dom,event,ajax,anim", function (S, Template, DOM, Event, io) {

    var waterFall = DOM.get('#filter-waterfall');

    var tpl = DOM.get('#tpl').innerHTML;

    Event.delegate('#nav-field', 'mousedown', 'b', function (ev) {
        var target = ev.currentTarget;
        var field = DOM.attr(target, 'data-field');
        var bNavObj = DOM.query('#nav-field b');
        var div = DOM.query('#filter-waterfall div');
        var index = S.indexOf(target, bNavObj);

        DOM.removeClass(div, 'active');
        DOM.addClass(div[index], 'active');

        DOM.removeClass(DOM.siblings(target), 'checked');
        DOM.addClass(target, 'checked');

        var waterFall = DOM.get('#filter-waterfall .active');

        var bObj = (DOM.query('b', waterFall));
        DOM.addClass(DOM.get('b', waterFall), 'checked');
        Event.fire(bObj[0], 'mousedown');
        var b = DOM.query('b', waterFall);
        var width = parseInt(990 / bObj.length, 10);
        DOM.css(b, {
            width: width
        });

        DOM.css(b[b.length - 1], {
            width: 990 - width * (bObj.length - 1)
        });

    });

    Event.delegate('#filter-waterfall', 'mousedown', 'b', function (ev) {
        var target = ev.currentTarget;
        var value = DOM.attr(target, 'data-value');
        DOM.removeClass(DOM.siblings(target), 'checked');
        DOM.addClass(target, 'checked');
        findFile();
    });

    Event.fire(DOM.get('b', '#nav-field'), 'mousedown');

    var currentData = [];

    var num = 10;//每页显示多少条
    var idx = 1;

    function P() {

        this.data = [];
        var self = this;

        function go() {
            var curDate;
            if (self.data.length > num) {
                curDate = self.data.slice((idx - 1) * num, (idx - 1) * num + num);
            } else {
                curDate = self.data;
            }
            DOM.get('#portfolio-container').innerHTML = Template(tpl).render({docs: curDate});
        }

        this.render = function (data) {
            self.totalPage = Math.ceil(data.docs.length / num);
            self.data = data.docs;
            go();
        };

        this.next = function () {
            idx++;
            if (idx > self.totalPage) {
                idx = self.totalPage;
            }
            go();
        };

        this.prev = function () {
            idx--;
            if (idx < 1) {
                idx = 1;
            }
            go();
        }


    }

    var p = new P();

    Event.delegate('#p', 'mousedown', 'b', function (ev) {
        var target = ev.target;
        p[target.className]();
    });

    Event.delegate('#portfolio-container', 'mouseenter mouseleave', 'b.pic-container', function (ev) {
        var target = ev.currentTarget;
        if (ev.type === 'mouseenter') {
            DOM.append(DOM.create('<u class="icon"></u>'), target)
        } else {
            DOM.remove(DOM.get('u.icon', target));
        }
    });


    function findFile() {
        var category = DOM.get('b.checked', '#nav-field');
        var data = {};
        data[DOM.attr(category, 'data-field')] = DOM.attr(DOM.get('b.checked', '#filter-waterfall div.active'), 'data-value');
        KISSY.io({
            url: "/filter",
            type: "get",
            dataType: "json",
            data: data,
            //http://localhost/filter?category=WEB&date=2011
            success: function (data) {
                data.docs = S.filter(data.docs, function (item) {
                    return item.width > 250 && item.height > 250;
                });
                currentData = data.docs;
                idx = 1;
                p.render(data);

            }
        })
    }

    KISSY.use("ua,event,node,overlay", function (S, UA, Event, Node, O) {
        var dialog = new O.Dialog({
            width: 670,
            elCls: 'my',
            aria: false,
            highlighted: false,
            focused: false,
            elStyle: {
                position: UA.ie == 6 ? "absolute" : "fixed",
                zIndex: 999999
            },
            bodyContent: '',
            mask: true,
            align: {
                points: ['cc', 'cc']
            }
        });

        function show() {
            dialog.show();
            var mask = DOM.get('div.ks-ext-mask');
            if (mask) mask.style.zIndex = '999998';
        }


        function center() {
            S.log("ie center");
            if (dialog.get("visible")) {
                dialog.center();
            }
        }

        var index = 0;
        Event.delegate('#portfolio-container', 'mousedown', '.pic-container', function (ev) {
            var target = ev.currentTarget;
            var id = DOM.attr(target, 'data-id');
            S.each(currentData, function (item, i) {
                if (item._id === id) {
                    index = i;
                    return false;
                }
            });

            render()

        });

        function render() {
            var cur = currentData[index];
            dialog.set('bodyContent', '<div id="fixed-image"><b class="prev-image"></b><b class="next-image"></b><i></i><span><a href="/file/' + cur._id + '" target="_blank"><img src="/file/' + cur._id + (cur.width >= 670 ? '_670' : '') + '"></a></span></div> ');

            show();
        }

        Event.on(document, 'keydown', function (ev) {
            var c = ev.keyCode;
            if (c === 27) dialog.hide();
            if (dialog.get("visible") && c === 39 || c === 40 || c == 37 || c == 38) {
                if (c === 39 || c === 40) {
                    next();
                } else if (ev.keyCode == 37 || ev.keyCode == 38) {
                    prev();
                }
                ev.preventDefault();
            }
        });


        function next() {
            index++;
            if (index > currentData.length - 1) index = currentData.length - 1;
            render();

        }

        function prev() {
            index--;
            if (index < 0) index = 0;
            render();
        }

        Event.delegate(document.body, 'mousedown', '.prev-image', function (ev) {
            prev();
        });

        Event.delegate(document.body, 'mousedown', '.next-image', function (ev) {
            next();
        });


        Event.on('#team', 'click', function () {
            dialog.set('bodyContent', '<div id="fixed-image"><i></i><a href="http://www.jeef.com.cn:1280/file/50f29d76c8d870f843000007" target="_blank"><img src="http://www.jeef.com.cn:1280/file/50f29d76c8d870f843000007_670" /></a></div> ');
            show()
        });

        Event.on(window, 'resize scroll', center);


    });

    KISSY.ready(function (S) {
        var DOM = S.DOM, Event = S.Event;
        var nav = DOM.get('#nav-container');
        var isIE6 = KISSY.UA.ie === 6;
        var cls = isIE6 ? 'fixed-ie6' : 'fixed';
        var top = DOM.offset('#nav-container').top;

        Event.on(window, 'scroll', function () {
            var scrollTop = DOM.scrollTop();
            scrollTop >= top ? DOM.addClass(nav, cls) : DOM.removeClass(nav, cls);
            if (isIE6 && scrollTop >= top) {
                DOM.css(nav, {top: scrollTop + 'px'});
            } else {
                DOM.css(nav, {top: '0px'});
            }
        });

        //默认执行一次
        Event.fire(window, 'scroll');


        var cl;
        var point = DOM.get('#point');
        Event.on(window, 'scroll', function () {
            if (S.Anim.isRunning(point))  return;
            S.Anim(point, {opacity: 0}, .1, 'easeNone',function () {
                if (cl) clearTimeout(cl);
                cl = setTimeout(function () {
                    S.Anim.stop(point, false);
                    S.Anim(point, {opacity: 1}, .2).run();
                }, 500)
            }).run();
        });


    });

    var copyRight = DOM.get('#copy-right');
    Event.delegate(document.body, 'click', '.notify-contact', function (ev) {
        ev.halt();
        copyRight.scrollIntoView();
        var color = DOM.css(copyRight, 'background-color');
        var index = 0;

        function anim() {
            S.Anim.stop(copyRight, false);
            S.Anim(copyRight, {'background-color': index % 2 === 0 ? '#c9c9c9' : '#dcdcdc'}, .1, 'easeNone',function () {
                index++;
                if (index < 6) anim();
            }).run()
        }

        anim();

    });

    Event.delegate('#point', 'mousedown', 'a', function (ev) {
        var target = ev.target;
        DOM.removeClass(DOM.siblings(target), 'active');
        DOM.addClass(target, 'active');
    });
});

</script>


</body>
</html>
